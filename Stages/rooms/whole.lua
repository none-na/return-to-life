-- Generated by ProvEdit version 0.1 --
local STAGE_INFO = {
    name = "A Moment, Whole",
    subname = "",
    width = 3360,
    height = 1088,
    music = ":nothing:"
}

local STAGE_LAYERS = {
    {
        depth = 12,
        sprite = "TileEmpty2",
        origin = "RoR2Demake",
        tiles = {
            [197] = {
                [37] = {1,1}, 
            },
            [97] = {
                [37] = {1,1}, 
            },
            [195] = {
                [37] = {1,1}, 
            },
            [49] = {
                [37] = {1,1}, 
            },
            [92] = {
                [37] = {1,1}, 
            },
            [207] = {
                [37] = {1,1}, 
            },
            [105] = {
                [37] = {1,1}, 
            },
            [51] = {
                [37] = {1,1}, 
            },
            [62] = {
                [37] = {1,1}, 
            },
            [100] = {
                [37] = {1,1}, 
            },
            [113] = {
                [37] = {1,1}, 
            },
            [45] = {
                [37] = {1,1}, 
            },
            [108] = {
                [37] = {1,1}, 
            },
            [121] = {
                [37] = {1,1}, 
            },
            [47] = {
                [37] = {1,1}, 
            },
            [63] = {
                [37] = {1,1}, 
            },
            [116] = {
                [37] = {1,1}, 
            },
            [133] = {
                [37] = {1,1}, 
            },
            [138] = {
                [37] = {1,1}, 
            },
            [37] = {
                [37] = {1,1}, 
            },
            [127] = {
                [37] = {1,1}, 
            },
            [128] = {
                [37] = {1,1}, 
            },
            [149] = {
                [37] = {1,1}, 
            },
            [154] = {
                [37] = {1,1}, 
            },
            [41] = {
                [37] = {1,1}, 
            },
            [61] = {
                [37] = {1,1}, 
            },
            [143] = {
                [37] = {1,1}, 
            },
            [144] = {
                [37] = {1,1}, 
            },
            [165] = {
                [37] = {1,1}, 
            },
            [170] = {
                [37] = {1,1}, 
            },
            [29] = {
                [37] = {1,1}, 
            },
            [159] = {
                [37] = {1,1}, 
            },
            [160] = {
                [37] = {1,1}, 
            },
            [181] = {
                [37] = {1,1}, 
            },
            [186] = {
                [37] = {1,1}, 
            },
            [33] = {
                [37] = {1,1}, 
            },
            [175] = {
                [37] = {1,1}, 
            },
            [176] = {
                [37] = {1,1}, 
            },
            [198] = {
                [37] = {1,1}, 
            },
            [23] = {
                [37] = {1,1}, 
            },
            [192] = {
                [37] = {1,1}, 
            },
            [71] = {
                [37] = {1,1}, 
            },
            [28] = {
                [37] = {1,1}, 
            },
            [204] = {
                [37] = {1,1}, 
            },
            [15] = {
                [37] = {1,1}, 
            },
            [58] = {
                [37] = {1,1}, 
            },
            [69] = {
                [37] = {1,1}, 
            },
            [20] = {
                [37] = {1,1}, 
            },
            [7] = {
                [37] = {1,1}, 
            },
            [75] = {
                [37] = {1,1}, 
            },
            [12] = {
                [37] = {1,1}, 
            },
            [57] = {
                [37] = {1,1}, 
            },
            [73] = {
                [37] = {1,1}, 
            },
            [4] = {
                [37] = {1,1}, 
            },
            [83] = {
                [37] = {1,1}, 
            },
            [59] = {
                [37] = {1,1}, 
            },
            [79] = {
                [37] = {1,1}, 
            },
            [91] = {
                [37] = {1,1}, 
            },
            [87] = {
                [37] = {1,1}, 
            },
            [99] = {
                [37] = {1,1}, 
            },
            [203] = {
                [37] = {1,1}, 
            },
            [189] = {
                [37] = {1,1}, 
            },
            [94] = {
                [37] = {1,1}, 
            },
            [107] = {
                [37] = {1,1}, 
            },
            [102] = {
                [37] = {1,1}, 
            },
            [115] = {
                [37] = {1,1}, 
            },
            [110] = {
                [37] = {1,1}, 
            },
            [123] = {
                [37] = {1,1}, 
            },
            [118] = {
                [37] = {1,1}, 
            },
            [134] = {
                [37] = {1,1}, 
            },
            [137] = {
                [37] = {1,1}, 
            },
            [124] = {
                [37] = {1,1}, 
            },
            [38] = {
                [37] = {1,1}, 
            },
            [65] = {
                [37] = {1,1}, 
            },
            [131] = {
                [37] = {1,1}, 
            },
            [150] = {
                [37] = {1,1}, 
            },
            [153] = {
                [37] = {1,1}, 
            },
            [140] = {
                [37] = {1,1}, 
            },
            [42] = {
                [37] = {1,1}, 
            },
            [64] = {
                [37] = {1,1}, 
            },
            [147] = {
                [37] = {1,1}, 
            },
            [166] = {
                [37] = {1,1}, 
            },
            [169] = {
                [37] = {1,1}, 
            },
            [156] = {
                [37] = {1,1}, 
            },
            [30] = {
                [37] = {1,1}, 
            },
            [67] = {
                [37] = {1,1}, 
            },
            [163] = {
                [37] = {1,1}, 
            },
            [182] = {
                [37] = {1,1}, 
            },
            [185] = {
                [37] = {1,1}, 
            },
            [172] = {
                [37] = {1,1}, 
            },
            [34] = {
                [37] = {1,1}, 
            },
            [66] = {
                [37] = {1,1}, 
            },
            [179] = {
                [37] = {1,1}, 
            },
            [21] = {
                [37] = {1,1}, 
            },
            [200] = {
                [37] = {1,1}, 
            },
            [190] = {
                [37] = {1,1}, 
            },
            [26] = {
                [37] = {1,1}, 
            },
            [13] = {
                [37] = {1,1}, 
            },
            [18] = {
                [37] = {1,1}, 
            },
            [5] = {
                [37] = {1,1}, 
            },
            [10] = {
                [37] = {1,1}, 
            },
            [2] = {
                [37] = {0,1}, 
            },
            [55] = {
                [37] = {1,1}, 
            },
            [82] = {
                [37] = {1,1}, 
            },
            [56] = {
                [37] = {1,1}, 
            },
            [78] = {
                [37] = {1,1}, 
            },
            [53] = {
                [37] = {1,1}, 
            },
            [90] = {
                [37] = {1,1}, 
            },
            [54] = {
                [37] = {1,1}, 
            },
            [86] = {
                [37] = {1,1}, 
            },
            [50] = {
                [37] = {1,1}, 
            },
            [201] = {
                [37] = {1,1}, 
            },
            [96] = {
                [37] = {1,1}, 
            },
            [191] = {
                [37] = {1,1}, 
            },
            [93] = {
                [37] = {1,1}, 
            },
            [52] = {
                [37] = {1,1}, 
            },
            [104] = {
                [37] = {1,1}, 
            },
            [101] = {
                [37] = {1,1}, 
            },
            [46] = {
                [37] = {1,1}, 
            },
            [112] = {
                [37] = {1,1}, 
            },
            [109] = {
                [37] = {1,1}, 
            },
            [48] = {
                [37] = {1,1}, 
            },
            [120] = {
                [37] = {1,1}, 
            },
            [117] = {
                [37] = {1,1}, 
            },
            [39] = {
                [37] = {1,1}, 
            },
            [135] = {
                [37] = {1,1}, 
            },
            [136] = {
                [37] = {1,1}, 
            },
            [125] = {
                [37] = {1,1}, 
            },
            [130] = {
                [37] = {1,1}, 
            },
            [43] = {
                [37] = {1,1}, 
            },
            [151] = {
                [37] = {1,1}, 
            },
            [152] = {
                [37] = {1,1}, 
            },
            [60] = {
                [37] = {1,1}, 
            },
            [141] = {
                [37] = {1,1}, 
            },
            [146] = {
                [37] = {1,1}, 
            },
            [31] = {
                [37] = {1,1}, 
            },
            [167] = {
                [37] = {1,1}, 
            },
            [168] = {
                [37] = {1,1}, 
            },
            [157] = {
                [37] = {1,1}, 
            },
            [162] = {
                [37] = {1,1}, 
            },
            [35] = {
                [37] = {1,1}, 
            },
            [183] = {
                [37] = {1,1}, 
            },
            [184] = {
                [37] = {1,1}, 
            },
            [173] = {
                [37] = {1,1}, 
            },
            [178] = {
                [37] = {1,1}, 
            },
            [70] = {
                [37] = {1,1}, 
            },
            [202] = {
                [37] = {1,1}, 
            },
            [24] = {
                [37] = {1,1}, 
            },
            [188] = {
                [37] = {1,1}, 
            },
            [27] = {
                [37] = {1,1}, 
            },
            [208] = {
                [37] = {2,1}, 
            },
            [68] = {
                [37] = {1,1}, 
            },
            [16] = {
                [37] = {1,1}, 
            },
            [19] = {
                [37] = {1,1}, 
            },
            [74] = {
                [37] = {1,1}, 
            },
            [8] = {
                [37] = {1,1}, 
            },
            [11] = {
                [37] = {1,1}, 
            },
            [72] = {
                [37] = {1,1}, 
            },
            [3] = {
                [37] = {1,1}, 
            },
            [81] = {
                [37] = {1,1}, 
            },
            [77] = {
                [37] = {1,1}, 
            },
            [89] = {
                [37] = {1,1}, 
            },
            [85] = {
                [37] = {1,1}, 
            },
            [98] = {
                [37] = {1,1}, 
            },
            [199] = {
                [37] = {1,1}, 
            },
            [193] = {
                [37] = {1,1}, 
            },
            [95] = {
                [37] = {1,1}, 
            },
            [205] = {
                [37] = {1,1}, 
            },
            [106] = {
                [37] = {1,1}, 
            },
            [103] = {
                [37] = {1,1}, 
            },
            [114] = {
                [37] = {1,1}, 
            },
            [111] = {
                [37] = {1,1}, 
            },
            [122] = {
                [37] = {1,1}, 
            },
            [119] = {
                [37] = {1,1}, 
            },
            [132] = {
                [37] = {1,1}, 
            },
            [40] = {
                [37] = {1,1}, 
            },
            [139] = {
                [37] = {1,1}, 
            },
            [126] = {
                [37] = {1,1}, 
            },
            [129] = {
                [37] = {1,1}, 
            },
            [148] = {
                [37] = {1,1}, 
            },
            [44] = {
                [37] = {1,1}, 
            },
            [155] = {
                [37] = {1,1}, 
            },
            [142] = {
                [37] = {1,1}, 
            },
            [145] = {
                [37] = {1,1}, 
            },
            [164] = {
                [37] = {1,1}, 
            },
            [32] = {
                [37] = {1,1}, 
            },
            [171] = {
                [37] = {1,1}, 
            },
            [158] = {
                [37] = {1,1}, 
            },
            [161] = {
                [37] = {1,1}, 
            },
            [180] = {
                [37] = {1,1}, 
            },
            [36] = {
                [37] = {1,1}, 
            },
            [187] = {
                [37] = {1,1}, 
            },
            [174] = {
                [37] = {1,1}, 
            },
            [177] = {
                [37] = {1,1}, 
            },
            [22] = {
                [37] = {1,1}, 
            },
            [196] = {
                [37] = {1,1}, 
            },
            [194] = {
                [37] = {1,1}, 
            },
            [25] = {
                [37] = {1,1}, 
            },
            [206] = {
                [37] = {1,1}, 
            },
            [14] = {
                [37] = {1,1}, 
            },
            [17] = {
                [37] = {1,1}, 
            },
            [6] = {
                [37] = {1,1}, 
            },
            [9] = {
                [37] = {1,1}, 
            },
            [80] = {
                [37] = {1,1}, 
            },
            [76] = {
                [37] = {1,1}, 
            },
            [88] = {
                [37] = {1,1}, 
            },
            [84] = {
                [37] = {1,1}, 
            },
        }
    },
    {
        depth = 15,
        sprite = "TileEmpty2",
        origin = "RoR2Demake",
        tiles = {
            [49] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [100] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [63] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [138] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [204] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [69] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [57] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [73] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [4] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [91] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [94] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [110] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [118] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [64] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [169] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [10] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [82] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [56] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [90] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [50] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [104] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [101] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [109] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [117] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [168] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [70] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [188] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [74] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [11] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [3] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [81] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [193] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [95] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [205] = {
                [36] = {1,2}, [37] = {1,3}, 
            },
            [103] = {
                [36] = {0,3}, [35] = {0,2}, 
            },
            [139] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
            [187] = {
                [36] = {0,2}, [37] = {0,3}, 
            },
            [194] = {
                [36] = {1,3}, [35] = {1,2}, 
            },
        }
    },
}

local STAGE_COLLISION = {
    ["B"] = {
        {458,74}, {456,74}, {454,74}, {452,74}, {450,74}, {448,74}, {446,74}, {444,74}, {442,74}, {440,74}, {438,74}, {436,74}, {434,74}, {432,74}, {430,74}, {428,74}, {426,74}, {424,74}, {422,74}, {420,74}, 
        {418,74}, {416,74}, {414,74}, {412,74}, {410,74}, {408,74}, {406,74}, {404,74}, {402,74}, {400,74}, {398,74}, {396,74}, {394,74}, {392,74}, {390,74}, {388,74}, {386,74}, {384,74}, {382,74}, {380,74}, 
        {378,74}, {376,74}, {374,74}, {372,74}, {370,74}, {368,74}, {366,74}, {364,74}, {362,74}, {360,74}, {358,74}, {356,74}, {354,74}, {352,74}, {350,74}, {348,74}, {346,74}, {344,74}, {342,74}, {340,74}, 
        {338,74}, {336,74}, {334,74}, {332,74}, {330,74}, {328,74}, {326,74}, {324,74}, {322,74}, {320,74}, {318,74}, {316,74}, {314,74}, {312,74}, {310,74}, {308,74}, {306,74}, {304,74}, {302,74}, {300,74}, 
        {298,74}, {296,74}, {294,74}, {292,74}, {290,74}, {288,74}, {286,74}, {284,74}, {282,74}, {280,74}, {278,74}, {276,74}, {274,74}, {272,74}, {270,74}, {268,74}, {266,74}, {264,74}, {262,74}, {260,74}, 
        {258,74}, {256,74}, {254,74}, {252,74}, {250,74}, {248,74}, {246,74}, {244,74}, {242,74}, {240,74}, {238,74}, {236,74}, {234,74}, {232,74}, {230,74}, {228,74}, {226,74}, {224,74}, {222,74}, {220,74}, 
        {218,74}, {216,74}, {214,74}, {212,74}, {210,74}, {208,74}, {206,74}, {204,74}, {202,74}, {200,74}, {198,74}, {196,74}, {194,74}, {192,74}, {190,74}, {188,74}, {186,74}, {184,74}, {182,74}, {180,74}, 
        {178,74}, {176,74}, {174,74}, {172,74}, {170,74}, {168,74}, {166,74}, {164,74}, {162,74}, {160,74}, {158,74}, {156,74}, {154,74}, {152,74}, {150,74}, {148,74}, {146,74}, {144,74}, {142,74}, {140,74}, 
        {138,74}, {136,74}, {134,74}, {132,74}, {130,74}, {128,74}, {126,74}, {124,74}, {122,74}, {120,74}, {118,74}, {116,74}, {114,74}, {112,74}, {110,74}, {108,74}, {106,74}, {104,74}, {102,74}, {100,74}, 
        {98,74}, {96,74}, {94,74}, {92,74}, {90,74}, {88,74}, {86,74}, {84,74}, {82,74}, {80,74}, {78,74}, {76,74}, {74,74}, {72,74}, {70,74}, {68,74}, {66,74}, {64,74}, {62,74}, {60,74}, 
        {58,74}, {56,74}, {54,74}, {52,74}, {50,74}, {48,74}, {46,74}, {44,74}, {42,74}, {40,74}, {38,74}, {36,74}, {34,74}, {32,74}, {30,74}, {28,74}, {26,74}, {24,74}, {22,74}, {20,74}, 
        {18,74}, {16,74}, {14,74}, {12,74}, {10,74}, {8,74}, {6,74}, {4,74}, {2,74}, {0,74}, {-2,74}, {-4,74}, {-6,74}, {-8,74}, {-10,74}, {-12,74}, {-14,74}, {-16,74}, {-18,74}, {-20,74}, 
        {-22,74}, {-24,74}, {-26,74}, {-28,74}, {-30,74}, {-32,74}, 
    },
}

local STAGE_OBJECTS = {
}

local STAGE_BACKGROUNDS = {
    [10000] = {"WhiteNoise", "RoR2Demake", 1, 1, 1, 0, 0, 0, 0, 0 },
}

local STAGE_INTERACTABLES = {
}

local STAGE_ENEMIES = {
}

-- LEVEL DATA END --
local function r(t,n,o)local q=_G[t].find(n,o)return q or error("Failed to resolve "..n..":"..o.. " ("..t.."), make sure all resources are loaded before loading the stage.") end

local function mkObjs()
    local bg = Object("PELDR_BG")
    local ts = Object("PELDR_TS")
	local c = camera
	local x,y,w,h=0,0,0,0
    callback("onCameraUpdate", function() if bg:find(1) or ts:find(1) then x,y,w,h=camera.x,camera.y,camera.width,camera.height end end, -100)
    local z = {}
    callback("globalRoomEnd", function(r)
        for k, _ in pairs(z) do
            if Surface.isValid(k) then
                k:free()
            end
        end
    end, -100)
    
    local di,st,rst = graphics.drawImage,graphics.setTarget,graphics.resetTarget
    local function chnk(s, ts, x, y, o)
        local r = {0, 0, 16, 16}
        local d = {image = s, x = 0, y = 0, region = r}
        local sf = Surface(512, 512)
        st(sf)
        local w
        for _x = x / 16, (x + 512) / 16 do
            local q = ts[_x]
            if q ~= nil then
                for _y = y / 16, (y + 512) / 16 do
                    local t = q[_y]
                    if t ~= nil then
                        r[1] = t[1] * 16 + (o or (t[1] + 1))
                        r[2] = t[2] * 16 + (o or (t[2] + 1))
                        d.x = _x * 16 - x
                        d.y = _y * 16 - y
                        w = 1
                        di(d)
                    end
                end
            end
        end
        rst()
        if not w then
            sf:free()
            return 0
        else
            z[sf] = 1
            return sf
        end
    end
    local mf,mc = math.floor, math.ceil
    local vld = Surface.isValid
	ts:addCallback("draw", function(i)
		local d=i:getModData("PELDR")
        local c = d.c
        for X = mf(x / 512), mc((x + w) / 512) do
            local q = c[X]
            if q == nil then
                q = {}
                c[X] = {}
            end
            for Y = mf(y / 512), mc((y + h) / 512) do
                local cc = q[Y]
                if cc ~= 0 and not vld(cc) then
                    if cc ~= nil then
                        z[cc] = nil
                    end
                    cc = chnk(d.s, d.t, X * 512, Y * 512,d.g or 0)
                    q[Y] = cc
                end
                if cc ~= 0 then
                    cc:draw(X * 512, Y * 512)
                end
            end
        end
	end)
    
	bg:addCallback("draw", function(i)
		local d=i:getModData("PELDR")
		local s=d.s
		
		local fx,fy=d.x+x*d.px+w*d.xo,d.y+y*d.py+h*d.yo

		local sw,x1,x2=1,fx,fx
		if d.hr then
			sw = s.width
			x1 = x1 % sw + x - x % sw - sw
			x2 = x + w
		end

		local sh,y1,y2=1,fy,fy
		if d.vr then
			sh=s.height
			y1 = y1 % sh + y - y % sh - sh
			y2=y + h
		end

		for X=x1,x2,sw do for Y=y1,y2,sh do s:draw(X,Y)end end
	end)
	return ts,bg
end
local ts,bg=Object.find("PELDR_TS"),Object.find("PELDR_BG")
if ts == nil then ts,bg=mkObjs()end

local function spawnBG(sprite, depth, x, y, hrepeat, vrepeat, xparallax, yparallax, xpercentoffs, ypercentoffs)
	local i=bg:create(0,0)
	d=i:getModData("PELDR")
	i.depth = depth
	d.s = sprite
	d.x = x
	d.y = y
	d.hr = hrepeat
	d.vr = vrepeat
	d.px = xparallax
	d.py = yparallax
	d.xo = xpercentoffs
	d.yo = ypercentoffs
end

local function spawnTS(sprite, depth, tiles, grid)
	local i=ts:create(0,0)
	d=i:getModData("PELDR")
    i.depth = depth
    d.c = {}
    d.s = sprite
    d.g = grid
    d.t = tiles
end

local room = Room.new(STAGE_INFO.name)
room:resize(STAGE_INFO.width, STAGE_INFO.height)
for col, coordlist in pairs(STAGE_COLLISION) do
	local obj = Object.find(col, "Vanilla")
	for _, coords in ipairs(coordlist) do
        room:createInstance(obj, coords[1]*8, coords[2]*8)
    end
end
for _, objectlist in ipairs(STAGE_OBJECTS) do
	local obj = r("Object", objectlist[1], objectlist[2])
	for _, coords in ipairs(objectlist[3]) do
		room:createInstance(obj, coords[1]*8, coords[2]*8)
	end
end

local stage = Stage.new(STAGE_INFO.name)
stage.subname = STAGE_INFO.subname
stage.rooms:add(room)
stage.music = Sound.find(STAGE_INFO.music) or Sound.find("MusicStage1")

for _, i in ipairs(STAGE_INTERACTABLES) do
    stage.interactables:add(r("Interactable", i[1], i[2]))
end
for _, e in ipairs(STAGE_ENEMIES) do
    stage.enemies:add(r("MonsterCard", e[1], e[2]))
end

local bgs = {}
for k, v in pairs(STAGE_BACKGROUNDS) do
    table.insert(bgs, {r("Sprite", v[1], v[2]), k, v[7], v[8], v[3]==1, v[4]==1, v[5], v[6], v[9], v[10]})
end
local lrs = {}
for _, v in ipairs(STAGE_LAYERS) do
    table.insert(lrs, {r("Sprite", v.sprite, v.origin), v.depth, v.tiles, v.grid})
end
local function mrgcol(o)
    for _, v in ipairs(o:findAll()) do
        v.xscale = 1 / 16
    end
    local c
    repeat
        c = 0
        for _, v in ipairs(o:findAll()) do
            if v:isValid() and v.xscale < 1 then
                local s = o:findPoint(v:get("bbox_right") + 16, v.y)
                if s and s.xscale < 1 then
                    c = 1
                    v.xscale = v.xscale + s.xscale
                    s:destroy()
                end
            end
        end
    until c == 0
end
local bs = Object.find("bossSpawn","vanilla")
local bs2 = Object.find("bossSpawn2","vanilla")
callback("globalRoomStart", function(r)
    if r == room then
        for _, v in ipairs(bgs) do
            spawnBG(table.unpack(v))
        end
        for _, v in ipairs(lrs) do
            spawnTS(table.unpack(v))
        end
        mrgcol(bs)
        mrgcol(bs2)
    end
end)


return stage